<div class="container-fluid vh-100 text-white p-0 d-flex trilha-wrapper">
  <!-- SIDEBAR -->
  <aside class="sidebar d-flex flex-column p-3">
    <h2 class="fw-bold text-white mb-4">MONEVA</h2>
    <ul class="nav flex-column">
      <li class="nav-item mb-2"><a class="nav-link text-white" routerLink="/home">ğŸ  Home</a></li>
      <li class="nav-item mb-2"><a class="nav-link text-white active" routerLink="/trilha">ğŸ’° Trilha de Aprendizado</a></li>
      <li class="nav-item mb-2"><a class="nav-link text-white" routerLink="/demonstrativos">ğŸ“Š Demonstrativos</a></li>
      <li class="nav-item"><a class="nav-link text-white" routerLink="/conquistas">ğŸ† Conquistas</a></li>
    </ul>
  </aside>

  <!-- CONTEÃšDO PRINCIPAL -->
  <main class="flex-grow-1 trilha-main overflow-auto">
    <div class="trilha-topbar d-flex justify-content-between align-items-center">
      <div>
        <div class="topbar-subtitle">TRILHA</div>
        <h3 class="fw-semibold text-success m-0">Trilha de Aprendizado</h3>
      </div>

      <div class="d-flex align-items-center gap-3">
        <div class="xp-badge">
          <span class="xp-label">XP total</span>
          <span class="xp-value">{{ totalXp() }}</span>
        </div>

        <!-- BotÃ£o agora sÃ³ abre o modal -->
        <button class="btn btn-outline-light btn-sm" (click)="openResetDialog()">
          Resetar progresso
        </button>
      </div>
    </div>

    <div class="trilha container py-2">
      @for (sec of sections; track sec.id) {
        <section class="trilha__section mb-5">
          <div class="d-flex align-items-center justify-content-between mb-3">
            <h5 class="trilha__title m-0">{{ sec.title }}</h5>
            <small class="activity-count">{{ doneCount(sec) }}/{{ sec.nodes.length }} concluÃ­dos</small>
          </div>

          <div class="tower">
            @for (node of sec.nodes; track node.id; let i = $index) {
              <div class="unit-wrap" [class.shift-left]="i % 2 === 0" [class.shift-right]="i % 2 === 1">
                <button type="button"
                        class="unit"
                        [class.unit--lesson]="node.kind === 'lesson'"
                        [class.unit--game]="node.kind === 'game'"
                        [class.is-locked]="getStatus(node.id) === 'locked'"
                        [class.is-unlocked]="getStatus(node.id) === 'unlocked'"
                        [class.is-completed]="getStatus(node.id) === 'completed'"
                        [disabled]="getStatus(node.id) === 'locked'"
                        [routerLink]="routeFor(node.id)">

                  <span class="ring" [style.--p]="progressOf(node.id) + '%'"></span>
                  <span class="icon">{{ node.emoji }}</span>

                  @if (getStatus(node.id) === 'locked')    { <span class="state">ğŸ”’</span> }
                  @if (getStatus(node.id) === 'completed') { <span class="state">âœ…</span> }
                </button>

                <div class="unit-label text-center" [innerHTML]="node.title"></div>

                @if (isCurrent(sec, i)) {
                  <div class="start-badge">COMEÃ‡AR</div>
                }
              </div>
            }
          </div>
        </section>
      }
    </div>
  </main>
</div>

<!-- Modal de confirmaÃ§Ã£o de reset -->
@if (showResetDialog) {
  <div class="reset-backdrop">
    <div class="reset-modal card text-white p-4">
      <h5 class="mb-3">Resetar progresso</h5>
      <p class="mb-4">
        Tem certeza que deseja <strong>resetar todo o seu progresso</strong> na trilha?<br>
        VocÃª vai perder o XP e todas as atividades concluÃ­das.
      </p>

      <div class="d-flex justify-content-end gap-2">
        <button
          type="button"
          class="btn btn-secondary btn-sm"
          (click)="closeResetDialog()">
          Cancelar
        </button>

        <button
          type="button"
          class="btn btn-danger btn-sm"
          (click)="confirmReset()">
          Sim, resetar
        </button>
      </div>
    </div>
  </div>
}
