<!-- src/app/pages/demonstrativos/demonstrativos.html -->
<div class="board">
  <!-- ======= Sidebar (mantida como no restante do app) ======= -->
  <aside class="sidebar d-flex flex-column p-3">
    <h2 class="fw-bold text-white mb-4">MONEVA</h2>
    <ul class="nav flex-column">
      <li class="nav-item mb-2"><a class="nav-link text-white" routerLink="/home">üè† Home</a></li>
      <li class="nav-item mb-2"><a class="nav-link text-white" routerLink="/trilha">üí∞ Trilha de Aprendizado</a></li>
      <li class="nav-item mb-2"><a class="nav-link aside text-white active" routerLink="/demonstrativos">üìä Demonstrativos</a></li>
      <li class="nav-item"><a class="nav-link text-white" routerLink="/conquistas">üèÜ Conquistas</a></li>
    </ul>
  </aside>

  <!-- ======= Conte√∫do ======= -->
  <main class="main">

    <!-- Topbar -->
    <header class="topbar">
      <button class="icon-btn text-white" (click)="mudarMes(-1)"><i class="bi bi-chevron-left"></i></button>

      <div class="brand">
        <div class="logo text-white">Moneva</div>
        <small class="muted">Todas as contas</small>
      </div>

      <div class="month">{{ nomeMes() }}</div>

      <div class="actions">
        <button class="icon-btn text-white"><i class="bi bi-funnel"></i></button>
        <button class="icon-btn text-white"><i class="bi bi-search"></i></button>
        <button class="icon-btn text-white" (click)="mudarMes(1)"><i class="bi bi-chevron-right"></i></button>
        <button class="icon-btn text-white"><i class="bi bi-three-dots-vertical"></i></button>
      </div>
    </header>

    <!-- Anel central + Percentuais ao redor -->
    <section class="ring-area">
      <div class="ring-wrap">
        <canvas id="ringChart"></canvas>

        <!-- Centro do anel -->
        <div class="ring-center">
          <div class="in-label green">R$ {{ totalEntradas | number:'1.2-2' }}</div>
          <div class="out-label red">R$ {{ totalSaidas | number:'1.2-2' }}</div>
        </div>

        <!-- ‚ÄúBal√µezinhos‚Äù de % ao redor do anel -->
        <div class="orbit">
          @for (g of gastosPorCategoria; track g.nome; let i = $index) {
            <div class="bubble" [style.--i]="i" [style.--n]="gastosPorCategoria.length">
              <span class="pct">{{ g.pct }}%</span>
              <span class="emoji">{{ g.emoji }}</span>
            </div>
          }
        </div>
      </div>
    </section>

    <!-- Barra de saldo -->
    <section class="saldo-bar">
      <div class="saldo-chip">
        <span>Saldo</span>
        <strong>R$ {{ saldo | number:'1.2-2' }}</strong>
      </div>
    </section>

    <!-- Hist√≥rico simples (opcional) -->
    <section class="history">
      @for (t of transacoes; track t.id) {
        <div class="rowi">
          <div class="left">
            <div class="cat">{{ t.categoria }}</div>
            <small class="muted">{{ t.meio | titlecase }} ‚Ä¢ {{ t.data | date:'dd/MM' }}</small>
          </div>
          <div class="right" [class.in]="t.tipo==='entrada'" [class.out]="t.tipo==='saida'">
            {{ t.tipo==='entrada' ? '+' : '-' }} R$ {{ t.valor | number:'1.2-2' }}
          </div>
          <button class="trash" (click)="confirmarExcluir(t.id)"><i class="bi bi-trash"></i></button>
        </div>
      }
    </section>

    <!-- Bot√µes flutuantes gigantes -->
    <div class="fab-bar">
      <button class="fab minus" (click)="abrirAdd('saida')">‚àí</button>
      <button class="fab plus"  (click)="abrirAdd('entrada')">+</button>
    </div>
  </main>
</div>

<!-- ===== Modal Adicionar ===== -->
@if (showAdd()) {
  <div class="modal">
    <div class="modal-card">
      <h5 class="mb-2 text-white">{{ novo.tipo==='entrada' ? 'Nova Entrada' : 'Nova Despesa' }}</h5>

      <div class="grid">
        <label>Data
          <input style="color: white;"
          type="date"
          [value]="dateToInput(novo.data)"
          (change)="onDateChange($event)" />
        </label>

        <label>Meio
          <select [(ngModel)]="novo.meio">
            <option value="pix">PIX</option>
            <option value="dinheiro">Dinheiro</option>
            <option value="debito">D√©bito</option>
            <option value="credito">Cr√©dito</option>
            <option value="boleto">Boleto</option>
            <option value="outro">Outro</option>
          </select>
        </label>

        <label>Categoria
          <select [(ngModel)]="novo.categoria">
            @for (c of categorias; track c.nome) {
              <option [value]="c.nome">{{ c.emoji }} {{ c.nome }}</option>
            }
          </select>
        </label>

        <label>Valor (R$)
          <input type="number" step="0.01" min="0" [(ngModel)]="novo.valor" />
        </label>

        <label class="full">Observa√ß√£o
          <input type="text" [(ngModel)]="novo.obs" />
        </label>
      </div>

      <div class="modal-actions">
        <button class="btn ghost" (click)="fecharAdd()">Cancelar</button>
        <button class="btn ghost" (click)="salvarTransacao()">Salvar</button>
      </div>
    </div>
  </div>
}

<!-- ===== Modal de Confirma√ß√£o ===== -->
@if (showConfirm().open) {
  <div class="modal">
    <div class="modal-card confirm">
      <p class="text-white">Deseja realmente excluir esta transa√ß√£o?</p>
      <div class="modal-actions">
        <button class="btn ghost" (click)="cancelarExcluir()">Cancelar</button>
        <button class="btn danger" (click)="excluirConfirmado()">Excluir</button>
      </div>
    </div>
  </div>
}
